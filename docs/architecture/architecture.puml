@startuml arquitectura_sistema_aria
!theme plain
title Arquitectura del Sistema de NavegaciÃ³n con Meta Aria Glasses

package "Hardware Layer" {
    component [Meta Aria Glasses] as Aria
    note right of Aria
        - CÃ¡mara RGB (60fps)
        - SLAM1/SLAM2 (perifÃ©rico)
        - IMU (movimiento)
    end note
}

package "StreamingService" {
    component [DeviceManager] as DM
    component [Observer] as Obs
    
    note right of DM
        AdquisiciÃ³n de datos
        - ConexiÃ³n USB/WiFi
        - Streaming profiles
        - CalibraciÃ³n RGB
    end note
    
    note right of Obs
        - Callbacks RGB/SLAM/IMU
        - Thread-safe buffers
        - RotaciÃ³n + conversiÃ³n
    end note
}

package "DetectionService" {
    component [YoloProcessor] as YOLO
    component [ImageEnhancer] as Enhancer
    component [DepthEstimator] as Depth
    
    note right of YOLO
        DetecciÃ³n de objetos
        - YOLOv11n (CPU)
        - Confidence > 0.6
        - Objetos navegaciÃ³n
    end note
    
    note right of Enhancer
        - CLAHE low-light
        - Auto-detection
        - Gamma correction
    end note
    
    note right of Depth
        - MiDaS/Depth Anything
        - Device MPS/CPU
        - Distancias mÃ©tricas
    end note
}

package "DecisionService" {
    component [NavigationPipeline] as Pipeline
    component [DecisionEngine] as Engine
    component [MotionDetector] as Motion
    
    note right of Pipeline
        InterpretaciÃ³n detecciones
        - Enhancement â†’ Depth â†’ YOLO
        - Cache depth map
        - Stage timings
    end note
    
    note right of Engine
        - ZonificaciÃ³n espacial (5 zonas)
        - EstimaciÃ³n distancia
        - Prioridad + relevancia
        - Motion-aware cooldown
    end note
    
    note right of Motion
        - IMU magnitude
        - Stationary/Walking
        - Adaptive behavior
    end note
}

package "SpeechService" {
    component [AudioSystem] as Audio
    component [NavigationAudioRouter] as Router
    component [RgbAudioRouter] as RgbRouter
    component [SlamAudioRouter] as SlamRouter
    
    note right of Audio
        RetroalimentaciÃ³n auditiva
        - macOS TTS (say)
        - Queue async
        - Cooldown tracking
    end note
    
    note right of Router
        - Priority queue RGB+SLAM
        - Per-source cooldowns
        - Metrics JSONL
    end note
}

package "Presentation Layer" {
    component [PresentationManager] as Presentation
    component [FrameRenderer] as Renderer
    component [OpenCVDashboard] as Dashboard
    
    note right of Presentation
        - UI faÃ§ade
        - FPS tracking
        - Keyboard input
    end note
}

' Relaciones entre componentes
Aria --> DM : "Datos raw"
DM --> Obs : "Streaming"
Obs --> Pipeline : "RGB frames"
Obs --> Motion : "IMU data"

Pipeline --> Enhancer : "Frame"
Enhancer --> Depth : "Enhanced"
Depth --> YOLO : "Frame + depth"
YOLO --> Engine : "Detections"
Motion --> Engine : "Motion state"

Engine --> RgbRouter : "Decision candidates"
Engine --> SlamRouter : "SLAM events"
RgbRouter --> Router : "RGB commands"
SlamRouter --> Router : "SLAM commands"
Router --> Audio : "Prioritized commands"

Audio --> "Usuario" : "ðŸ”Š Audio feedback"

Pipeline --> Renderer : "Annotated frame"
Renderer --> Dashboard : "Visual"
Dashboard --> Presentation : "Display"
Presentation --> "Usuario" : "ðŸ‘ï¸ Visual feedback"

' ConfiguraciÃ³n centralizada
package "Utils" {
    component [Config] as Cfg
    note right of Cfg
        - Single source of truth
        - YOLO_CONFIDENCE
        - TARGET_FPS
        - ZONE_SYSTEM
    end note
}

YOLO ..> Cfg : "lee"
Audio ..> Cfg : "lee"
Enhancer ..> Cfg : "lee"
Engine ..> Cfg : "lee"

@enduml