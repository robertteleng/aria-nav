@startuml arquitectura_sistema_completo
!theme plain
title Figura 2.1 - Arquitectura Modular del Sistema de Navegación Asistida
skinparam componentStyle rectangle
skinparam backgroundColor white

package "Hardware Layer" <<Rectangle>> {
    component [Meta Aria Glasses] as Aria #LightBlue
    note right of Aria
        Sensores:
        · RGB: 60 FPS
        · SLAM1/SLAM2: 30 FPS
        · IMU: 100 Hz
        · Magnetómetro
    end note
}

package "Data Acquisition Layer" <<Rectangle>> {
    component [DeviceManager] as DM #LightGreen
    component [Observer] as Obs #LightGreen
    
    note right of DM
        Conexión USB/WiFi
        Streaming profiles
        Calibración RGB
    end note
}

package "Processing Layer" <<Rectangle>> {
    component [NavigationPipeline] as Pipeline #Yellow
    
    package "Vision Modules" {
        component [ImageEnhancer] as Enhance #Wheat
        component [DepthEstimator] as Depth #Wheat
        component [YoloProcessor] as YOLO #Wheat
    }
    
    note right of Enhance
        CLAHE + Gamma
        Auto low-light
    end note
    
    note right of Depth
        MiDaS (MPS)
        Cache cada 10 frames
    end note
    
    note right of YOLO
        YOLOv11n (CPU)
        Confidence: 0.45
    end note
}

package "Intelligence Layer" <<Rectangle>> {
    component [NavigationDecisionEngine] as Engine #Orange
    component [MotionDetector] as Motion #Orange
    
    note right of Engine
        Análisis espacial
        Priorización objetos
        5 zonas visuales
    end note
    
    note right of Motion
        Clasificación IMU
        Stationary/Walking
    end note
}

package "Audio Layer" <<Rectangle>> {
    component [NavigationAudioRouter] as Router #LightCoral
    component [AudioSystem] as Audio #LightCoral
    
    note right of Router
        Priority queue
        Per-source cooldown
        RGB + SLAM events
    end note
    
    note right of Audio
        TTS: pyttsx3/espeak
        Queue asíncrono
        Threading no-bloqueante
    end note
}

package "Presentation Layer" <<Rectangle>> {
    component [PresentationManager] as Present #Lavender
    component [OpenCVDashboard] as Dashboard #Lavender
    component [FrameRenderer] as Renderer #Lavender
    
    note right of Dashboard
        FPS tracking
        Visualización detecciones
        Controles interactivos
    end note
}

' Flujo de datos principal
Aria -down-> DM : USB/WiFi stream
DM -down-> Obs : Callbacks RGB/SLAM/IMU
Obs -down-> Pipeline : Frame + metadata
Pipeline -down-> Enhance : Raw frame
Enhance -down-> Depth : Enhanced frame
Depth -down-> YOLO : Frame + depth map

YOLO -down-> Engine : Detections
Obs -right-> Motion : IMU data
Motion -down-> Engine : Motion state

Engine -down-> Router : Decision candidates
Router -down-> Audio : Prioritized commands
Audio -down-> Present : Status updates

Pipeline -right-> Renderer : Annotated frame
Renderer -down-> Dashboard : Visual output
Dashboard -up-> Present : User input (keyboard)

' Leyenda
legend right
    |= Color |= Capa |
    | <#LightBlue> | Hardware |
    | <#LightGreen> | Adquisición |
    | <#Yellow> | Procesamiento |
    | <#Orange> | Inteligencia |
    | <#LightCoral> | Audio |
    | <#Lavender> | Presentación |
endlegend

@enduml